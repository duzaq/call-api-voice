version: '3.8'

services:
  app:
    build: .
    ports:
      - "5060:5060"
    volumes:
      - .:/app
      - ./audio:/app/audio # Montar o diretório de áudios para o contêiner do app
    env_file:
      - .env
    command: python app.py

  opensips:
    image: opensips/opensips:3.3
    ports:
      - "5060:5060/udp"
    volumes:
      - ./cfg:/usr/local/etc/opensips  # Confirme se esta linha está correta
      - ./audio:/var/www/html/audio
    depends_on:
      - app
    command: opensips -f /usr/local/etc/opensips/opensips.cfg

  nginx:
    image: nginx:latest
    ports:
      - "8081:80"  # Porta alterada para 8081 (ou outra porta livre)
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf
      - ./audio:/var/www/html/audio
    depends_on:
      - app
